<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore-compat.js"></script>
    <style>
        :root { --primary: #CCF02F; --bg: #121212; --card: #1e1e1e; }
        body { font-family: sans-serif; margin: 0; background: var(--bg); color: #fff; overflow-x: hidden; }
        
        /* Sidebar Menu */
        #sidebar { position: fixed; left: -280px; top: 0; bottom: 0; width: 280px; background: #000; transition: 0.4s cubic-bezier(0.1, 0.7, 1.0, 0.1); z-index: 1000; padding: 30px 20px; box-shadow: 10px 0 30px rgba(0,0,0,0.5); }
        #sidebar.active { left: 0; }
        .menu-item { padding: 18px; border-radius: 12px; margin-bottom: 5px; cursor: pointer; display: flex; align-items: center; gap: 15px; color: #aaa; transition: 0.3s; }
        .menu-item:hover, .menu-item.active { background: var(--card); color: var(--primary); }

        /* Content Area */
        .content { padding: 25px; transition: 0.4s; }
        header { display: flex; align-items: center; gap: 20px; margin-bottom: 30px; }
        .dot-menu { font-size: 28px; cursor: pointer; background: var(--card); width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }

        input { width: 100%; padding: 15px; margin: 10px 0; background: #2c2c2e; border: 1px solid #333; border-radius: 12px; color: #fff; box-sizing: border-box; }
        button { width: 100%; padding: 15px; background: var(--primary); border: none; border-radius: 12px; font-weight: bold; font-size: 16px; margin-top: 15px; cursor: pointer; }
        
        .panel { display: none; }
        .panel.active { display: block; animation: slideUp 0.4s; }
        @keyframes slideUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }

        .stat-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 15px; }
        .stat-box { background: var(--card); padding: 25px; border-radius: 20px; text-align: center; border: 1px solid #333; }
        .user-row { background: var(--card); padding: 15px; border-radius: 15px; margin-bottom: 10px; display: flex; justify-content: space-between; align-items: center; }
    </style>
</head>
<body>

    <div id="sidebar">
        <h2 style="color: var(--primary); margin-bottom: 40px; padding-left: 15px;">Toto Console</h2>
        <div class="menu-item active" onclick="showPanel('dashboard')">üìä Dashboard</div>
        <div class="menu-item" onclick="showPanel('streams')">üì∫ Live Streams</div>
        <div class="menu-item" onclick="showPanel('members')">üë• Members</div>
        <div class="menu-item" onclick="showPanel('settings')">‚öôÔ∏è App Settings</div>
    </div>

    <div class="content" id="mainContent">
        <header>
            <div class="dot-menu" onclick="toggleMenu()">‚ãÆ</div>
            <h2 id="pTitle">Dashboard</h2>
        </header>

        <!-- Dashboard -->
        <div id="dashboard" class="panel active">
            <div class="stat-grid">
                <div class="stat-box"><span style="color:var(--dim); font-size:12px;">TOTAL USERS</span><h1 id="countUsers">0</h1></div>
                <div class="stat-box"><span style="color:var(--dim); font-size:12px;">LIVE NOW</span><h1 id="countLive">0</h1></div>
            </div>
        </div>

        <!-- Live Streams -->
        <div id="streams" class="panel">
            <div style="background:var(--card); padding:20px; border-radius:20px; margin-bottom:25px;">
                <h3>Add New Stream</h3>
                <input type="text" id="sTitle" placeholder="Stream Title">
                <input type="text" id="sThumb" placeholder="Thumbnail URL">
                <input type="text" id="sUrl" placeholder="Stream URL (m3u8/Embed)">
                <button onclick="saveStream()">Publish Stream</button>
            </div>
            <div id="streamList"></div>
        </div>

        <!-- Members -->
        <div id="members" class="panel">
            <div id="userList"></div>
        </div>

        <!-- App Settings -->
        <div id="settings" class="panel">
            <div style="background:var(--card); padding:20px; border-radius:20px;">
                <label>App Logo Link</label>
                <input type="text" id="appLogo" placeholder="https://image.com/logo.png">
                <label>App Display Name</label>
                <input type="text" id="appName" placeholder="Toto Stream">
                <button onclick="saveSettings()">Update App</button>
            </div>
        </div>
    </div>

    <script>
        const firebaseConfig = {
            apiKey: "AIzaSyCn72TD-I1yI6-7oCCGlx1Mudh_ZlT7138",
            authDomain: "totostream.firebaseapp.com",
            projectId: "totostream",
            appId: "1:22142190592:web:e937438ca67f37cbbcc4e5"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        function toggleMenu() { document.getElementById('sidebar').classList.toggle('active'); }

        function showPanel(id) {
            document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.menu-item').forEach(m => m.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            document.getElementById('pTitle').innerText = id.charAt(0).toUpperCase() + id.slice(1);
            event.currentTarget.classList.add('active');
            toggleMenu();
            if(id === 'dashboard') loadStats();
            if(id === 'streams') loadStreams();
            if(id === 'members') loadMembers();
        }

        async function loadStats() {
            const uSnap = await db.collection('users').get();
            const sSnap = await db.collection('streams').get();
            document.getElementById('countUsers').innerText = uSnap.size;
            document.getElementById('countLive').innerText = sSnap.size;
        }

        async function saveStream() {
            await db.collection('streams').add({
                title: document.getElementById('sTitle').value,
                thumbnail: document.getElementById('sThumb').value,
                streamUrl: document.getElementById('sUrl').value,
                createdAt: firebase.firestore.FieldValue.serverTimestamp()
            });
            alert("Stream Published!"); loadStreams();
        }

        async function loadStreams() {
            const snap = await db.collection('streams').get();
            const div = document.getElementById('streamList');
            div.innerHTML = "";
            snap.forEach(doc => {
                div.innerHTML += `<div class="user-row"><span>${doc.data().title}</span><button onclick="delStream('${doc.id}')" style="width:auto; background:none; color:red; margin:0;">Delete</button></div>`;
            });
        }

        async function delStream(id) { if(confirm("Delete?")) { await db.collection('streams').doc(id).delete(); loadStreams(); } }

        async function loadMembers() {
            const snap = await db.collection('users').orderBy('createdAt', 'desc').get();
            const list = document.getElementById('userList');
            list.innerHTML = "";
            snap.forEach(doc => {
                const u = doc.data();
                list.innerHTML += `<div class="user-row">
                    <div><b>${u.name}</b><br><small>${u.points} pts</small></div>
                    <button style="width:auto; background:none; color:var(--primary); font-size:12px; margin:0;" onclick="editPoints('${doc.id}', ${u.points})">+/- Points</button>
                </div>`;
            });
        }

        async function editPoints(id, current) {
            const amount = prompt("Enter amount to add (use minus to deduct):", "100");
            if(amount) {
                await db.collection('users').doc(id).update({ points: firebase.firestore.FieldValue.increment(parseInt(amount)) });
                loadMembers();
            }
        }

        async function saveSettings() {
            await db.collection('settings').doc('app').set({
                logo: document.getElementById('appLogo').value,
                name: document.getElementById('appName').value
            });
            alert("App Settings Updated!");
        }

        loadStats();
    </script>
</body>
</html>
