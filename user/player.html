<!DOCTYPE html>
<html>
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="style.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.10.0/firebase-firestore-compat.js"></script>
</head>
<body>
    <div id="player" style="width:100%; aspect-ratio:16/9; background:black;">
        <iframe id="vFrame" src="" width="100%" height="100%" frameborder="0" allowfullscreen></iframe>
    </div>
    <div style="padding:20px;">
        <h2 id="vTitle">Loading...</h2>
        <p style="color:green;">Earn 10 pts per minute!</p>
    </div>

    <script>
        const firebaseConfig = {
    apiKey: "AIzaSyCn72TD-I1yI6-7oCCGlx1Mudh_ZlT7138",
    authDomain: "totostream.firebaseapp.com",
    projectId: "totostream",
    storageBucket: "totostream.firebasestorage.app",
    messagingSenderId: "22142190592",
    appId: "1:22142190592:web:e937438ca67f37cbbcc4e5"
};
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();
        const tg = window.Telegram.WebApp;

        const id = new URLSearchParams(window.location.search).get('id');
        async function load() {
            const doc = await db.collection('streams').doc(id).get();
            document.getElementById('vFrame').src = doc.data().streamUrl;
            document.getElementById('vTitle').innerText = doc.data().title;
            
            setInterval(async () => {
                const uid = tg.initDataUnsafe.user.id.toString();
                await db.collection('users').doc(uid).update({
                    points: firebase.firestore.FieldValue.increment(10)
                });
            }, 60000);
        }
        load();
    </script>
</body>
</html>
